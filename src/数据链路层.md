# 数据链路层

<!-- toc -->

## 概述

数据链路层是计算机网络的七层模型（OSI模型）中的第二层，位于物理层和网络层之间。它的主要任务是为网络层提供可靠的数据传输服务，确保在物理传输介质上有效、无误地传输数据帧。数据链路层主要关注在单一物理网络内的节点之间的直接连接，并负责将数据包封装成数据帧进行传输。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img/20241103124335.png)


数据链路层是计算机网络中不可或缺的一部分，为稳定和可靠的数据传输提供必要的支持。通过协议和标准，数据链路层负责确保数据的正确传输、设备的寻址、以及流量的控制。理解数据链路层的功能和机制对于网络工程师和IT专业人员在构建和维护网络时尤为重要。

以下将详细介绍数据链路层的主要功能、协议、框架与标准、类型、以及在计算机网络中的作用。

### 1. 数据链路层的主要功能

数据链路层的主要功能可以概括为以下几个方面：

#### 1.1 数据帧封装

数据链路层将网络层传输的数据包（数据单元）封装成数据帧。每个数据帧通常包含源和目的MAC地址、控制信息（例如，帧类型和长度）、数据负载和错误检测码等。

#### 1.2 物理地址寻址

数据链路层负责使用MAC地址对设备进行物理寻址。每个NIC（网络接口卡）通常具有唯一的MAC地址，用于标识网络上的设备。

#### 1.3 错误检测与纠正

数据链路层通过在帧中添加错误检测机制（如循环冗余检查，CRC）以确保数据的完整性。当接收方检测到帧的错误时，可以请求重传，确保数据的准确性。

#### 1.4 流量控制

数据链路层通过流量控制机制减少发送方和接收方之间的数据传输速率差异，例如使用停止-等待协议，防止丢包和缓冲区溢出。

#### 1.5 媒体访问控制

在共享传输介质中，数据链路层通过媒介访问控制（MAC）协议来协调多个设备对传输介质的访问，确保无冲突的稳定数据传输。常见的MAC协议包括CSMA/CD（载波监听多路访问/碰撞检测）和CSMA/CA（载波监听多路访问/碰撞避免）。

### 2. 数据链路层的协议与标准

数据链路层包含多种协议和标准，以满足不同网络技术的需求。主要的协议和标准有：

- **以太网（Ethernet）**：
  - 一种最常用的局域网（LAN）技术，采用CSMA/CD机制，实现数据帧的互通，广泛应用于家庭和企业网络。

- **Wi-Fi（无线局域网）**：
  - 基于IEEE 802.11标准的无线网络技术，采用CSMA/CA机制，以支持不同设备的无线连接。

- **点对点协议（PPP）**：
  - 一种用于点对点连接的协议，通常用于通过串行连接提供数据链路层服务，支持多种网络层协议。

- **Frame Relay**：
  - 一种广域网（WAN）技术，通过帧中继交换数据，适用于需要高带宽的网络应用。

- **HDLC（高级数据链路控制协议）**：
  - 一种用于同步和异步传输的协议，广泛用于点对点和多点通信网络。

### 3. 数据链路层的类型

数据链路层通常可以分为两种类型：

#### 3.1 逻辑链路控制（LLC）

逻辑链路控制子层为数据链路层的上层，主要负责提供面向连接的服务，管理不同网络协议的复用。LLC为上层协议提供了数据链路层服务的接口，通常采用IEEE 802.2标准。

#### 3.2 媒体访问控制（MAC）

媒体访问控制子层负责控制对物理介质的访问，确保不同设备能够高效地共享介质。MAC层使用各种机制，如CSMA/CD和CSMA/CA，以避免数据碰撞并处理冲突。

### 4. 数据链路层在计算机网络中的作用

数据链路层在计算机网络中起着至关重要的作用，其主要作用包括：

- **确保数据完整性**：
  - 数据链路层通过错误检测机制和重传策略，确保在传输过程中的数据完整性，防止错误的数据到达目的主机。

- **提供物理地址寻址**：
  - 通过MAC地址的使用，数据链路层为网络中不同设备提供了一种唯一的识别方法，实现设备间的有序通信。

- **优化网络性能**：
  - 通过流量控制和冲突避免机制，数据链路层帮助提升网络的性能，减少数据丢失。

- **支持不同网络协议**：
  - 数据链路层可以支持多种网络层协议（如IPv4、IPv6等），并实现它们的互通，增加了网络的灵活性和可扩展性。




## 封装成帧

封装成帧是指数据链路层给上层交付的协议数据单元添加帧头和帧尾使之成为帧

- **帧头和帧尾中包含有重要的控制信息**

发送方的数据链路层将上层交付下来的协议数据单元封装成帧后，还要通过物理层，将构成帧的各比特，转换成电信号交给传输媒体，那么接收方的数据链路层如何从物理层交付的比特流中提取出一个个的帧？

答：需要帧头和帧尾来做**帧定界**

但比不是每一种数据链路层协议的帧都包含有帧定界标志，例如下面例子

> 前导码
> 
> - 前同步码：作用是使接收方的时钟同步
>     
> - 帧开始定界符：表明其后面紧跟着的就是MAC帧
>     

另外以太网还规定了帧间间隔为96比特时间，因此，MAC帧不需要帧结束定界符
### 透明传输

> **透明**：指某一个实际存在的事物看起来却好像不存在一样。

透明传输是指**数据链路层对上层交付的传输数据没有任何限制**，好像数据链路层不存在一样

帧界定标志也就是个特定数据值，如果在上层交付的协议数据单元中， 恰好也包含这个特定数值，接收方就不能正确接收

> 所以数据链路层应该对上层交付的数据有限制，其内容不能包含帧定界符的值

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img/20241103125713.png)

**解决透明传输问题**

- **解决方法**：面向字节的物理链路使用**字节填充** (byte stuffing) 或**字符填充** (character stuffing)，面向比特的物理链路使用比特填充的方法实现透明传输
- 发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面**插入一个转义字符“ESC”**(其十六进制编码是1B)。
- 接收端的数据链路层在将数据送往网络层之前删除插入的转义字符。
- 如果转义字符也出现在数据当中，那么应在转义字符前面插入一个转义字符 ESC。当接收端收到连续的两个转义字符时，就删除其中前面的一个。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img/20241103125828.png)

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img/20241103125949.png)

## 差错检测

实际的通信链路都不是理想的，比特在传输过程中可能会产生差错：1可能会变成0，而0也可能变成1。这称为比特差错。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img/20241103130243.png)
### 奇偶校验

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img/20241103130321.png)

### 循环冗余校验CRC(Cyclic Redundancy Check)

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img/20241103130408.png)

算法要求生成多项式必须包含最低次项1

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img/20241103130616.png)

循环冗余校验 CRC 是一种检错方法，而帧校验序列 FCS 是添加在数据后面的冗余码

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img/20241103130748.png)

## 可靠传输

### 可靠传输的基本概念

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img/20241103131212.png)

常见传输差错：

- 比特差错：实际的通信链路都不是理想的，比特在传输过程中可能会产生差错：1可能会变成0，而0也可能变成1。
- 分组丢失：路由器输入队列快满了，主动丢弃收到的分组
- 分组失序：数据并未按照发送顺序依次到达接收端
- 分组重复：由于某些原因，有些分组在网络中滞留了，没有及时到达接收端，这可能会造成发送端对该分组的重发，重发的分组到达接收端，但一段时间后，滞留在网络的分组也到达了接收端，这就造成**分组重复**的传输差错

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img/20241103131242.png)

### 三种可靠协议

- 停止-等待协议SW
- 回退N帧协议GBN
- 选择重传协议SR

这三种可靠传输实现机制的基本原理并不仅限于数据链路层，可以应用到计算机网络体系结构的各层协议中。

### 可靠传输的实现机制—停止-等待协议

停止-等待协议可能遇到的四个问题

**确认与否认**

**超时重传**

**确认丢失**

> 既然数据分组需要编号，确认分组是否需要编号？
> 
> 要。如下图所示

**确认迟到**

> 注意，图中最下面那个数据分组与之前序号为0的那个数据分组不是同一个数据分组

**注意事项**

停止-等待协议的信道利用率

假设收发双方之间是一条直通的信道

- **TD**：是发送方发送数据分组所耗费的发送时延
- **RTT**：是收发双方之间的往返时间
- **TA**：是接收方发送确认分组所耗费的发送时延

TA一般都远小于TD，可以忽略，当RTT远大于TD时，信道利用率会非常低

像停止-等待协议这样通过确认和重传机制实现的可靠传输协议，常称为自动请求重传协议ARQ(**A**utomatic **R**epeat re**Q**uest)，意思是重传的请求是自动进行，因为不需要接收方显式地请求，发送方重传某个发送的分组。

### 可靠传输的实现机制—回退N帧协议

为什么用回退N帧协议？

在相同的时间内，使用停止-等待协议的发送方只能发送一个数据分组，而采用流水线传输的发送方，可以发送多个数据分组

回退N帧协议在流水线传输的基础上，利用发送窗口来限制发送方可连续发送数据分组的个数

### 无差错情况流程

发送方将序号落在发送窗口内的0~4号数据分组，依次连续发送出去

他们经过互联网传输正确到达接收方，就是没有乱序和误码，接收方按序接收它们，每接收一个，接收窗口就向前滑动一个位置，并给发送方发送针对所接收分组的确认分组，在通过互联网的传输正确到达了发送方

发送方每接收一个、发送窗口就向前滑动一个位置，这样就有新的序号落入发送窗口，发送方可以将收到确认的数据分组从缓存中删除了，而接收方可以择机将已接收的数据分组交付上层处理

### 累计确认

优点:

 - 即使确认分组丢失，发送方也可能不必重传
- 减小接收方的开销
 - 减小对网络资源的占用

缺点：
- 不能向发送方及时反映出接收方已经正确接收的数据分组信息

### 有差错情况

例如在传输数据分组时，5号数据分组出现误码，接收方通过数据分组中的检错码发现了错误，于是丢弃该分组，而后续到达的这剩下四个分组与接收窗口的序号不匹配。

接收同样也不能接收它们，讲它们丢弃，并对之前按序接收的最后一个数据分组进行确认，发送ACK4，**每丢弃一个数据分组，就发送一个ACK4**

当收到重复的ACK4时，就知道之前所发送的数据分组出现了差错，于是可以不等超时计时器超时就立刻开始重传，具体收到几个重复确认就立刻重传，根据具体实现决定

如果收到这4个重复的确认并不会触发发送立刻重传，一段时间后。超时计时器超时，也会将发送窗口内以发送过的这些数据分组全部重传

若WT超过取值范围，例如WT=8，会出现什么情况？

- 回退N帧协议在流水线传输的基础上利用发送窗口来限制发送方连续发送数据分组的数量，是一种连续ARQ协议
    
- 在协议的工作过程中发送窗口和接收窗口不断向前滑动，因此这类协议又称为滑动窗口协议
    
- 由于回退N帧协议的特性，当通信线路质量不好时，其信道利用率并不比停止-等待协议高
    

### 可靠传输的实现机制—选择重传协议

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250131232953.png)

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250131233016.png)


## 点对点协议PPP

- 点对点协议PPP（Point-to-Point Protocol）是目前使用最广泛的点对点数据链路层协议
- PPP协议是因特网工程任务组IEIF在1992年制定的。经过1993年和1994年的修订，现在的PPP协议已成为因特网的正式标准`[RFC1661，RFC1662]`
- 数据链路层使用的一种协议，它的特点是：简单；只检测差错，而不是纠正差错；不使用序号，也不进行流量控制；可同时支持多种网络层协议
- PPPoE 是宽带上网的主机使用的链路层协议

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250131233342.png)
### 帧格式

必须规定特殊的字符作为帧定界符

### 透明传输

必须保证数据传输的透明性

实现透明传输的方法

- 面向字节的异步链路：字节填充法（插入“转义字符”）
- 面向比特的同步链路：比特填充法（插入“比特0”）

能够对接收端收到的帧进行检测，并立即丢弃有差错的帧。

### 工作状态

- 当用户拨号接入 ISP 时，路由器的调制解调器对拨号做出确认，并建立一条物理连接。
- PC 机向路由器发送一系列的 LCP 分组（封装成多个 PPP 帧）。
- 这些分组及其响应选择一些 PPP 参数，并进行网络层配置，NCP 给新接入的 PC 机
- 分配一个临时的 IP 地址，使 PC 机成为因特网上的一个主机。
- 通信完毕时，NCP 释放网络层连接，收回原来分配出去的 IP 地址。接着，LCP 释放数据链路层连接。最后释放的是物理层的连接。

可见，PPP 协议已不是纯粹的数据链路层的协议，它还包含了物理层和网络层的内容。

## 媒体接入控制MAC

**媒体接入控制（介质访问控制）使用一对多的广播通信方式**

> **Medium Access Control**翻译成媒体接入控制，有些翻译成介质访问控制

**局域网的数据链路层**

- 局域网最主要的**特点**是：
    
    - 网络为一个单位所拥有；
    - 地理范围和站点数目均有限。
        
- 局域网具有如下**主要优点**：
    
    - 具有广播功能，从一个站点可很方便地访问全网。局域网上的主机可共享连接在局域网上的各种硬件和软件资源。
    - 便于系统的扩展和逐渐地演变，各设备的位置可灵活调整和改变。
    - 提高了系统的可靠性、可用性和残存性。
        

**数据链路层的两个子层**

为了使数据链路层能更好地适应多种局域网标准，IEEE 802 委员会就将局域网的数据链路层拆成**两个子层**：

1. **逻辑链路控制** LLC (Logical Link Control)子层；
2. **媒体接入控制** MAC (Medium Access Control)子层。

与接入到传输媒体有关的内容都放在 MAC子层，而 LLC 子层则与传输媒体无关。 **不管采用何种协议的局域网，对 LLC 子层来说都是透明的。**

# 媒体接入控制（MAC）

媒体接入控制（MAC）是计算机网络中的一个重要层，位于数据链路层（Layer 2），负责控制设备如何访问和使用共享的通信媒介（如无线路由器、以太网等）。本节将从以下四个小节详细介绍MAC的基本概念、静态信道划分、随机接入中的CSMA/CD和CSMA/CA协议。

### 1. 媒体接入控制的基本概念

1.1 定义

媒体接入控制是数据链路层的一个子层，负责在共享介质上管理多个网络设备的访问，以确保数据的可靠传输。它的主要任务是解决在同一网络环境中多个设备同时发送数据时的冲突问题。

1.2 功能

- **网络地址分配**：MAC层为每个网络接口分配唯一的MAC地址，这一地址用于在同一局域网内识别设备。
- **冲突检测与避免**：MAC层通过冲突检测和避免机制，确保多个设备在发送数据时不会产生干扰。
- **帧封装与解封装**：在数据帧的传输过程中，MAC层负责将网络层传来的数据封装成帧，并在接收端将其解封装。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201132625.png)
### 2. 媒体接入控制 — 静态划分信道

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201132731.png)

2.1 定义

静态划分信道是媒体接入控制的一种方法，通过预先划分信道，确保每个用户在特定时间或频率范围内的独占访问。这种方法的典型应用包括时分多址（TDMA）和频分多址（FDMA）。

2.2 实现方式

- **时分多址（TDMA）**：网络中的设备在时间上被划分成若干时隙，每个设备在特定的时隙内发送数据。这样可以避免冲突，实现公平访问。
  
  例如，蜂窝通信系统常常使用TDMA技术，每个用户在不同时间段内进行数据传输。

- **频分多址（FDMA）**：设备通过在不同的频段上同时发送数据，避免互相干扰。这种方式在广播和某些卫星通信技术中发挥重要作用。

2.3 优缺点

- **优点**：
  - 冲突概率低，资源利用率高，适合高稳定性场合。
  - 适合有确定通信需求的情况，比如固定容量的电话系统。

- **缺点**：
  - 灵活性差，无法根据业务量动态调整带宽资源。
  - 时间分配不均可能导致某些设备的空闲时间过长。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201132755.png)
### 3. 媒体接入控制 — 随机接入 — CSMA/CD协议

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201133128.png)

3.1 定义

CSMA/CD（Carrier Sense Multiple Access with Collision Detection）是一种随机接入协议，允许多个设备在共享信道上进行数据传输，同时能够检测和处理冲突。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201132900.png)

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201132935.png)

3.2 工作流程

1. **载波监听**：在发送数据之前，设备首先监听信道以确定是否空闲。
2. **数据发送**：如果信道空闲，设备开始发送数据帧。
3. **冲突检测**：在发送过程中，设备继续监听信道，检测是否发生冲突。如果监听到冲突，所有发送的设备会停止发送。
4. **重传机制**：检测到冲突后，设备会进行随机的退避处理（如等待一段随机时间），然后再尝试重新发送数据。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201133019.png)

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201133058.png)

3.3 应用场景

CSMA/CD主要应用于以太网和早期的局域网环境，适合较少设备且流量不大的网络。

3.4 限制

由于CSMA/CD在发生冲突时会导致延迟和网络效率降低，这使得它不适用于高流量或大量设备的网络，如现代以太网中已被全双工模式所取代。

### 4. 媒体接入控制 — 随机接入 — CSMA/CA协议

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201133259.png)

4.1 定义

CSMA/CA（Carrier Sense Multiple Access with Collision Avoidance）是另一种随机接入协议，主要用于无线网络，如Wi-Fi。其目标是避免而不是检测冲突。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201133443.png)

4.2 工作流程

1. **载波监听**：设备在发送数据之前同样监测信道是否空闲。
2. **数据发送请求**：如果信道空闲，设备发送RTS（请求发送）帧请求信道访问，目标设备接收到RTS后回复CTS（清除发送）帧。
3. **数据发送**：获得CTS后，发送方在确认信道空闲的情况下发送数据帧。
4. **确认机制**：接收设备在成功接收到数据后发送ACK（确认）帧给发送方。

4.3 应用场景

CSMA/CA广泛应用于无线局域网（如802.11协议），尤其是需要避免冲突的无线环境。

4.4 优势与局限

- **优势**：
  - 有效避免冲突，能在高流量环境中保持通信稳定。
  - 在某些情况下（如远程位置联网），无需担心信号干扰。

- **局限**：
  - 相比CSMA/CD，CSMA/CA协议的延迟更高，尤其是在高负载情况下。
  - 由于无线信道的不稳定性，数据包丢失的风险增加。

### 总结

媒体接入控制(MAC) 是确保网络中设备能够有效共享通道的重要机制。通过静态信道划分与随机接入协议，如CSMA/CD和CSMA/CA，MAC能够在不同的网络环境中平衡碰撞检测、资源利用率及网络延迟等因素，从而实现高效、稳定的数据传输。

## MAC地址与IP地址

在计算机网络中，MAC地址和IP地址是用于设备识别和通信的两种重要标识符，同时ARP（地址解析协议）和RARP（逆地址解析协议）则是用于这两者之间相互转换的协议。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201132015.png)

以下是对它们的详细介绍及其关系。

### MAC地址

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201132102.png)

MAC（Media Access Control）地址是一种唯一的物理地址，用于在局域网（LAN）中唯一标识网络接口设备。它通常由48位二进制数组成，通常以6个字节表示，形式为`00:1A:2B:3C:4D:5E`。

特点
- **硬件地址**：MAC地址在设备生产时被硬编码到网络接口卡（NIC）中，理论上是唯一的。
- **局部性**：MAC地址用于局域网通信，只有在同一局域网上的设备能直接使用它进行互相识别。
- **不可更改**：虽然有些设备可以通过软件修改MAC地址，但通常情况下，它是固定不变的。

### IP地址

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201132134.png)

IP（Internet Protocol）地址是网络中设备的逻辑地址，主要用于在互联网上进行设备定位和数据传输。它通常分为IPv4和IPv6两种格式：

- **IPv4**：形式为`192.168.1.1`，由32位二进制数组成，分为四个八位字节。
- **IPv6**：形式为`2001:0db8:85a3:0000:0000:8a2e:0370:7334`，由128位二进制数组成，使用冒号分隔的八组十六进制数表示。

特点：
- **逻辑地址**：IP地址不是硬件固定的，可以根据网络情况进行动态更改（如通过DHCP）。
- **全局性**：可以在更广泛的网络中进行通信，适用于广域网（WAN）和互联网。
- **分层结构**：IP地址由网络部分和主机部分组成，允许对网络进行分层，便于路由和管理。

### MAC地址与IP地址的关系

MAC地址和IP地址相辅相成，共同构成了网络通信的基本框架：
- **层次结构**：在OSI模型中，MAC地址属于数据链路层（Layer 2），而IP地址属于网络层（Layer 3）。网络数据包通过IP地址进行路由，而在局域网内通过MAC地址进行传输。
- **映射关系**：ARP将IP地址转换为MAC地址以便在局域网中通信，而RARP则允许网络设备依据其MAC地址请求其IP地址，建立通讯连接。




## ARP和RARP协议详解

### ARP协议

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201132231.png)

ARP（Address Resolution Protocol）是用于在局域网中，将IP地址解析为MAC地址的协议。当一个设备需要发送数据给另一个具有已知IP地址的设备时，它利用ARP获取目标设备的MAC地址。

工作流程：

1. **请求广播**：发送设备发送一个ARP请求帧，内容包含目标IP地址，请求“谁拥有这个IP地址，请回复我的MAC地址。”
2. **响应**：拥有该IP地址的设备接收到请求后，发送ARP应答帧，包含其MAC地址。
3. **更新表**：发送设备接收到应答后，会将这个IP地址和对应的MAC地址保存在其ARP缓存中，以便将来的通信。

### RARP协议

RARP（Reverse Address Resolution Protocol）是一种用于将MAC地址解析为IP地址的协议，主要用于那些没有持久存储设备的网络，如某些网络工作站和打印机。

工作流程：

1. **请求广播**：设备发送RARP请求，内容包含其MAC地址，请求“请告诉我我的IP地址。”
2. **响应**：RARP服务器提供对应的IP地址并发送回请求设备。
3. **配置**：设备获取到IP地址后，进行网络配置，开始正常的网络通信。






## 集线器与交换机的区别

在网络中，集线器（Hub）和交换机（Switch）都是用于连接多台设备的网络设备，但它们的工作原理和功能有显著的不同。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201120308.png)

以下是它们的详细比较：

### 1. 工作原理

集线器是一种简单的网络设备，用于连接多个设备并在它们之间传输数据。它通过将接收到的数据包广播到所有连接的端口，依靠所有设备共享同一个网络带宽。它没有智能分配流量的能力。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201120239.png)

交换机是一种更智能的网络设备，根据数据包的目的地址，将数据包发送到特定的设备。交换机能够学习连接设备的MAC地址，并通过维护地址表来优化数据传输，提高网络效率。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201120209.png)
### 2. 数据传输效率

由于采用广播机制，集线器在传输数据时可能导致网络拥塞，尤其是在设备较多时，这是因为所有设备共享同一带宽，容易造成碰撞。

交换机通过点对点的方式进行数据传输，能有效减少数据碰撞，提高网络的整体性能和带宽利用率。每个端口都拥有独立的带宽，允许多个设备同时进行数据传输。

### 3. 网络层次

集线器通常被认为是在OSI模型的物理层（Layer 1），只负责物理信号的传输，而不处理数据的内容。

交换机工作在OSI模型的链接层（Layer 2），根据数据链路层的地址进行数据转发，能够进行更复杂的网络处理。

### 4. 应用场景

集线器适用于小型网络或对性能要求不高的场景，通常用于临时连接或低流量需求的网络环境。

交换机更适合用于需要高性能和高带宽的企业网络，支持更复杂的网络架构，如VLAN和网络安全管理。

### 5. 成本

集线器通常成本较低，适合预算有限的小型网络。

交换机的成本相对较高，但随着技术的发展，价格逐渐降低，性价比不断提升。

### 总结

综上所述，尽管集线器和交换机都是连接网络设备的工具，但由于它们在工作原理、数据传输效率、网络层次、应用场景和成本等方面的差异，使用者应根据实际需要选择合适的网络设备。工作在数据链路层的以太网交换机，其性能远远超过工作在物理层的集线器，而且价格并不贵，这就使得集线器逐渐被市场淘汰。对于现代网络，交换机通常是更优的选择。

## 以太网交换机自学习和转发帧的流程

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201120557.png)

以太网交换机是一种智能网络设备，能够根据数据包的目标地址高效地转发信息。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201120438.png)

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250201120541.png)

其自学习和转发帧的流程复杂而又高效，以下是详细的介绍：

### 1. 自学习过程

1.1 MAC地址学习

以太网交换机通过监听传入的每个数据帧，从中提取源MAC地址并记录下这些地址。这一过程的步骤如下：

- **接收数据帧**：当数据帧到达交换机的某个端口时，交换机会读取该帧的源MAC地址。
- **更新地址表**：交换机会查看其MAC地址表（也称为转发表），如果该源MAC地址尚未存在于表中，交换机会将其记录下来，并关联到接收该数据帧的端口。
- **设置过期时间**：每个MAC地址表项都会有一个过期时间（通常为几分钟），如果在这段时间内未再接收到该MAC地址的数据帧，该表项将被删除。

1.2 学习效果的实现

通过这个过程，交换机能够建立一个动态的MAC地址表，使其能够记住网络中连接的设备，并优化数据转发。

### 2. 转发帧过程

2.1 接收数据帧

当交换机收到一个数据帧时，首先会分析帧的目标MAC地址和源MAC地址。

2.2 查找转发表

交换机会根据目标MAC地址查找其MAC地址表：

- **成功匹配**：如果找到了对应的目标MAC地址，交换机会将数据帧转发到记录的端口，只将数据发送到目标设备，避免不必要的广播。
- **未匹配**：如果没有找到目标MAC地址，交换机会将数据帧广播到所有其他端口（除了接收端口），允许目标设备响应并更新MAC地址表。

2.3 更新MAC地址表

在转发的同时，如果数据帧中还包含新的源MAC地址，交换机会根据前面描述的自学习过程更新MAC地址表。

2.4 处理特殊情况

在某些情况下，交换机还会执行额外的转发策略，例如：

- **广播帧**：当接收到广播帧（如ARP请求），交换机会在所有端口（除了源端口）转发该帧。
- **多播帧**：对于多播数据，交换机会根据配置的多播组转发数据帧。

### 3. 性能优化

3.1 端口隔离

为了提高网络性能，交换机可以在某些端口上设置隔离，在数据帧转发时，确保不影响其他端口的通信。

3.2 VLAN支持

交换机还可以通过虚拟局域网（VLAN）将网络进行逻辑划分，进一步提高网络性能和安全性。

### 总结

以太网交换机的自学习和转发帧流程使其成为一种高效的网络通信设备。通过动态学习源MAC地址并基于目标MAC地址进行帧转发，交换机能够优化网络流量，提高数据传输效率。这种智能化的处理方式使得现代网络能够支持日益增长的带宽需求和复杂数据流量管理。

## 以太网交换机的生成树协议STP

生成树协议（Spanning Tree Protocol，STP）是一种网络协议，旨在防止以太网交换机网络中的环路。网络中的环路会导致广播风暴、重复帧、以及网络效率的降低，因此STP被广泛应用于局域网（LAN）中的交换机网络，以确保数据的有效和稳定传输。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250131234319.png)

生成树协议（STP）是保持以太网交换机网络中数据稳定传输的重要协议，通过创建无环路的网络拓扑，避免重发和广播风暴的问题。尽管STP存在收敛速度慢和带宽利用不充分的不足，但其基本原理和实现方案仍然在众多大型网络中可以有效保障网络的运行。了解STP和其变种（如RSTP、MSTP等）的使用，有助于网络管理者构建和维护高效、稳定的网络。

以下将详细介绍STP的工作原理、主要组件、优势及局限性、STP的类型及其配置。

### 1. STP的工作原理

STP通过创建无环路的拓扑结构，确保在多个交换机和桥接设备之间建立稳定的逻辑连接。其基本工作原理如下：

1.1 选举根桥（Root Bridge）

在STP网络中，首先通过根桥选举的方式确定网络的“中心”。所有交换机根据其优先级和MAC地址相比较，选出一个具有最低桥接标识符（Bridge ID）的交换机作为根桥。

- **桥接标识符**：桥接标识符由优先级（默认为32768）和交换机的MAC地址组成。

1.2 计算最佳路径

一旦确定根桥，各个交换机将依据根桥的MAC地址，计算与根桥的最优路径。每个交换机通过生成树算法（Spanning Tree Algorithm，STA）确定到根桥的最短路径，进而建立无环路的拓扑结构。

1.3 端口状态转换

在确保网络无环的基础上，STP会将每个端口分配不同的状态，包括：

- **阻塞（Blocking）**：端口不参与数据转发，仅接收BPDU（桥协议数据单元）。
- **监听（Listening）**：端口在等待确认没有环路的情况下准备转发数据，但尚未实际转发数据。
- **学习（Learning）**：端口开始学习MAC地址，并准备转发数据，但尚未转发数据。
- **转发（Forwarding）**：端口处于转发状态，可以进行正常的数据发送和接收。
- **关闭（Disabled）**：端口被禁用，不会参与任何数据传输。

### 2. STP的主要组件

STP的实施依赖多个重要的组件，这些组件共同协作以维护网络的稳定性：

2.1 桥接设备

所有在同一STP域内的交换机或桥都是参与STP过程的设备。它们交换BPDU信息，以便得知当前网络的拓扑状态。

2.2 BPDU（桥协议数据单元）

BPDU是一种由交换机发送的信息包，包含关于网络拓扑的信息，包括根桥的身份、路径成本及端口状态等。BPDU是STP协议运作的核心，交换机利用BPDU信息维护和更新拓扑结构。

2.3 路径成本

路径成本是用于评估到根桥的网络开销。STP根据路径成本选择最优转发路径，成本的计算基于连接速度（例如，千兆以太网的路径成本低于百兆以太网）。

### 3. STP的优势及局限性

3.1 优势

- **避免网络环路**：
  - STP可以有效防止因网络环路带来的广播风暴和转发问题，确保网络的稳定性。

- **动态拓扑更新**：
  - STP能够在网络拓扑发生变化（如设备添加或故障）时，自动重新计算并更新路径。

- **链路冗余**：
  - STP支持网络中的链路冗余设计，确保在主链路失败的情况下，备用链路能够自动启用，提升网络的可靠性。

3.2 局限性

- **收敛速度慢**：
  - STP在网络拓扑变化时的收敛速度相对较慢，可能会导致短时间内的网络不稳定。

- **无法有效利用带宽**：
  - 在STP中，某些链路可能处于阻塞状态，导致网络带宽未能得到充分利用。

### 4. STP的类型

随着网络技术的发展，出现了多个STP的变种，主要包括：

4.1 Rapid Spanning Tree Protocol（RSTP）

RSTP（IEEE 802.1w）是STP的增强版本，通过快速收敛机制缩短了收敛时间，通常在几秒钟内完成。这使得网络能够在链路故障或拓扑变化时迅速恢复。

4.2 Multiple Spanning Tree Protocol（MSTP）

MSTP（IEEE 802.1s）允许多个VLAN在同一网络中共享一个生成树实例。通过这种方法，可以优化网络资源的分配，提高多个VLAN的流量效率。

4.3 Per VLAN Spanning Tree（PVST）

PVST是一种Cisco专有的STP实现，支持针对每个VLAN独立运行STP，从而为每个VLAN实现独立的生成树。

### 5. STP的配置

STP的配置通常在以太网交换机的管理界面上进行，基本的配置步骤包括：

1. **开启STP**：确保交换机上启用STP功能。
2. **设置优先级**：根据需要配置交换机的桥接优先级，以影响根桥的选举。
3. **观察BPDU**：监控BPDU的流量，以确保STP正常运行。
4. **配置端口**：根据需要将某些端口设置为阻塞、转发等不同状态。

## 虚拟局域网VLAN

虚拟局域网（Virtual Local Area Network，VLAN）是一种逻辑上划分网络的技术，使得在同一物理网络基础设施上能够创建多个逻辑分隔的网络。VLAN可以将不同的网络设备和用户根据业务需求进行划分，增强网络管理的灵活性、安全性和性能。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250131233628.png)

虚拟局域网（VLAN）是一种强大的网络管理工具，能够在物理网络层面上实现灵活的逻辑隔离。通过使用VLAN，组织可以有效管理网络、安全隔离部门流量、优化性能并简化网络管理流程。了解VLAN的工作原理与配置，以及其应用场景，有助于网络工程师和管理者构建高效、安全的网络环境。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250131233853.png)

以下将详细介绍VLAN的工作原理、优势、常见协议、应用场景及其配置。

### 1. VLAN的工作原理

VLAN的基本工作原理是通过交换机上的逻辑配置来分隔数据流，即使这些设备在物理上连接在同一交换机上或同一网络中。 VLAN的创建和管理通常依赖于802.1Q（IEEE标准）协议，允许网络管理员将一个物理网络划分成多个虚拟网络。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250131233810.png)


![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250131233828.png)
#### 1.1 标识和标记

在VLAN中，每个VLAN都有一个唯一的标识符，称为VLAN ID。在以太网帧中，802.1Q协议在以太网帧头中添加一个4字节的标签，指示该帧属于哪个VLAN。这个标签包含VLAN ID，从而接收交换机能够识别到帧的来源和去向。

#### 1.2 VLAN成员

设备可以通过交换机上的端口被分配到特定的VLAN。这些端口可以是接入端口（Access Port）或汇聚端口（Trunk Port）。

- **接入端口**：连接到终端设备（如计算机、打印机等），允许它们接入属于该VLAN的数据传输。
- **汇聚端口**：用于连接多个VLAN之间的交换机，允许在不同VLAN之间进行数据通信。

### 2. VLAN的优势

VLAN技术带来了许多显著的优势，包括：

#### 2.1 增强网络安全性

通过将不同部门或团队的设备分配到不同的VLAN，VLAN可以有效隔离潜在的网络攻击和未经授权的访问，提高整体网络安全性。

#### 2.2 流量管理与性能优化

VLAN可以减少广播流量的传播，因为广播数据包仅在同一VLAN内转发，从而提升网络性能和管理效率。

#### 2.3 灵活的网络管理

VLAN使网络管理员能够根据需要灵活地划分网络，无需物理更改网络拓扑，简化了网络的重组和扩展过程。

#### 2.4 简化故障排查

由于VLAN能够将设备分组到逻辑网络中，因此在故障排查时，可以更容易识别和隔离问题，从而提高网络的可用性。

### 3. 常见的VLAN类型

根据功能和设置，VLAN可以细分为几种类型：

#### 3.1 基于端口的VLAN

最常见的VLAN类型，通过交换机的端口来根据设备类型、位置或用户需求进行分配。每个端口只属于一个VLAN。

#### 3.2 基于MAC地址的VLAN

根据设备的MAC地址进行VLAN分配，MAC地址表决定设备的VLAN归属。这种方法相对灵活，但在管理上稍显复杂。

#### 3.3 基于协议的VLAN

此VLAN类型根据层2协议进行划分，允许同一网络接口上的不同协议流量被分配到不同的VLAN中。

#### 3.4 动态VLAN

通过802.1X等协议动态分配VLAN，允许设备在接入网络时自动与适当的VLAN关联。这种类型通常用于需要更高安全性的环境。

### 4. VLAN的配置

VLAN的配置通常涉及到多个步骤，典型的配置流程包括：

1. **交换机配置**：在交换机上创建VLAN并为每个VLAN分配一个唯一的VLAN ID。
2. **端口分配**：将交换机的端口分配到指定的VLAN，可能包括将特定端口设置为接入端口或汇聚端口。
3. **配置VLAN间路由**：如果需要不同VLAN之间的通信，则需配置三层交换机或路由器进行VLAN间路由。
4. **测试与监控**：通过网络监控工具测试VLAN的配置和性能，确保VLAN能够正常工作。

### 5. VLAN在网络中的应用场景

VLAN能够在各种网络环境中得到广泛应用，主要包括：

- **企业内部网络**：
  - 不同部门（如财务、研发、市场等）可以使用不同的VLAN，以便于管理和提升安全性。

- **教育网络**：
  - 学校可以将教师、学生和来宾的设备分别划分到不同的VLAN，以实现灵活的网络管理和安全隔离。

- **大型数据中心**：
  - 通过VLAN划分不同的服务和应用，优化资源利用率并简化管理。

- **虚拟化环境**：
  - 在虚拟化环境中，VLAN可用于隔离虚拟机流量，提供增强的安全性和管理能力。



